<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>快速开始 | Hexo LeanCloud Counter</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/hexo-leancloud-counter/assets/css/0.styles.84512009.css" as="style"><link rel="preload" href="/hexo-leancloud-counter/assets/js/app.7e995820.js" as="script"><link rel="preload" href="/hexo-leancloud-counter/assets/js/2.2dd1278b.js" as="script"><link rel="preload" href="/hexo-leancloud-counter/assets/js/9.15056421.js" as="script"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/10.1fe4c7d5.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/11.861c3eb3.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/12.cd117bad.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/13.00770887.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/3.04ba6bf9.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/4.78dc510e.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/5.feb76d03.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/6.36621159.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/7.2dac0a31.js"><link rel="prefetch" href="/hexo-leancloud-counter/assets/js/8.4318ac8b.js">
    <link rel="stylesheet" href="/hexo-leancloud-counter/assets/css/0.styles.84512009.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hexo-leancloud-counter/zh/" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">Hexo LeanCloud Counter</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/LEAFERx/hexo-leancloud-counter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hexo-leancloud-counter/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/hexo-leancloud-counter/zh/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/LEAFERx/hexo-leancloud-counter" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/hexo-leancloud-counter/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/hexo-leancloud-counter/zh/" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hexo-leancloud-counter/zh/" class="active sidebar-link">快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#前置要求" class="sidebar-link">前置要求</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#创建-leancloud-应用" class="sidebar-link">创建 LeanCloud 应用</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#创建-counter-类" class="sidebar-link">创建 Counter 类</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#将你的文章列表同步到-leancloud" class="sidebar-link">将你的文章列表同步到 LeanCloud</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#为你的应用添加-hookguard" class="sidebar-link">为你的应用添加 hookguard</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#集成到你的主题" class="sidebar-link">集成到你的主题</a></li><li class="sidebar-sub-header"><a href="/hexo-leancloud-counter/zh/#更多" class="sidebar-link">更多</a></li></ul></li><li><a href="/hexo-leancloud-counter/zh/tagsandhelpers.html" class="sidebar-link">标签（Tags）与辅助函数（Helpers）</a></li><li><a href="/hexo-leancloud-counter/zh/troubleshooting.html" class="sidebar-link">常见问题</a></li><li><a href="/hexo-leancloud-counter/zh/manuallysetup.html" class="sidebar-link">手动设置 ACL</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="快速开始"><a href="#快速开始" aria-hidden="true" class="header-anchor">#</a> 快速开始</h1> <h2 id="前置要求"><a href="#前置要求" aria-hidden="true" class="header-anchor">#</a> 前置要求</h2> <ul><li>Node.js &gt;= 6.9.0</li> <li>Hexo &gt;= 3.0</li> <li>一个 <a href="https://leancloud.cn" target="_blank" rel="noopener noreferrer">LeanCloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 账号</li></ul> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <div class="warning custom-block"><p class="custom-block-title">WARNING</p> <p>将该插件安装在<strong>博客</strong>目录下，而不是主题目录。</p></div> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> --save hexo-leancloud-counter
</code></pre></div><h2 id="创建-leancloud-应用"><a href="#创建-leancloud-应用" aria-hidden="true" class="header-anchor">#</a> 创建 LeanCloud 应用</h2> <p>前往 <a href="https://leancloud.cn/dashboard/" target="_blank" rel="noopener noreferrer">LeanCloud 控制台<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 创建一个应用。</p> <p>在应用界面里，点击 <code>设置 -&gt; 应用 key</code> 来获得你的 app id，app key 和 master key。</p> <p>根据 <a href="https://leancloud.cn/docs/data_security.html#hash532104796" target="_blank" rel="noopener noreferrer">LeanCloud 数据与安全指南<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 设置你的应用 Web 安全域名。</p> <h2 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h2> <p>将以下配置写入 <code>_config.yml</code>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">leancloud_counter</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">app_id</span><span class="token punctuation">:</span> <span class="token comment"># app id</span>
  <span class="token key atrule">app_key</span><span class="token punctuation">:</span> <span class="token comment"># app key</span>
  <span class="token key atrule">master_key</span><span class="token punctuation">:</span> <span class="token comment"># (可选) master key</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">为什么该插件需要 master key？</p> <p>因为不正确的 ACL 设置，之前集成 LeanCloud Counter 的方法均有安全漏洞。
为了解决这个问题，我们必须保证只有博主可以增删 Counter 中的文章条目。
<a href="https://github.com/theme-next/hexo-leancloud-counter-security" target="_blank" rel="noopener noreferrer">hexo-leancloud-counter-security<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 插件通过创建一个 admin 用户来解决这个问题，但这种方法十分复杂。使用 master key 可以使插件和插件的使用方法更加简单便捷。</p></div> <div class="tip custom-block"><p class="custom-block-title">如何确保 master key 的安全？</p> <p>该插件会通过以下三种途径获取 master key（优先级从高到低）：</p> <ul><li>通过 <code>_config.yml</code></li> <li>通过 <code>HEXO_LEANCLOUD_COUNTER_MASTER_KEY</code> 环境变量</li> <li>如果以上均为设置，该插件会在命令行中询问</li></ul> <p>如果你只在本地环境部署你的博客，推荐的做法是直接将 master key 放在 <code>_config.yml</code> 中。</p> <p>如果你使用 CI 工具等部署你的博客，并且 <code>_config.yml</code> 是公开的，请使用环境变量以保证 master key 的安全。</p></div> <div class="danger custom-block"><p class="custom-block-title">DANGER</p> <p>妥善保管你的 master key。如果不慎泄露，应立即重新生成。</p></div> <p>同时将该插件加入 <code>_config.yml</code> 的 <code>deploy</code> 列表:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> leancloud_counter_sync
<span class="token comment"># - type: 其他的 deployer</span>
</code></pre></div><h2 id="创建-counter-类"><a href="#创建-counter-类" aria-hidden="true" class="header-anchor">#</a> 创建 Counter 类</h2> <p>如果 Counter 类已经创建，请跳过该步骤。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果应用是新建的，你需要等待应用完成初始化（大约 5 分钟）后才能创建类。</p></div> <p>该步骤需要安装 <a href="https://pptr.dev/" target="_blank" rel="noopener noreferrer">Puppeteer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. 不过，如果没有安装，该插件会自动为你安装好。</p> <p>运行以下命令：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>hexo lc-counter init
</code></pre></div><p>该插件即会设置好一切。</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Puppeteer 只在这个步骤被用到，所以你现在完全可以卸载它。</p></div> <p>如果你不能或不想安装 Puppeteer，参见 <a href="./manuallysetup">手动设置 ACL</a>。</p> <h2 id="将你的文章列表同步到-leancloud"><a href="#将你的文章列表同步到-leancloud" aria-hidden="true" class="header-anchor">#</a> 将你的文章列表同步到 LeanCloud</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>hexo g <span class="token operator">&amp;&amp;</span> hexo d
</code></pre></div><h2 id="为你的应用添加-hookguard"><a href="#为你的应用添加-hookguard" aria-hidden="true" class="header-anchor">#</a> 为你的应用添加 hookguard</h2> <p>在你的应用中，点击 <code>云引擎 -&gt; 设置</code>，在 <code>代码库</code> 中填入 <code>https://github.com/LEAFERx/hexo-leancloud-counter-hookguard.git</code> 然后点击 <code>保存</code>。</p> <p>然后，点击 <code>云引擎 -&gt; 部署 -&gt; git 源码部署 -&gt; 部署</code>。</p> <p>当日志打印出 <code>hookguard deployed</code>，hookguard 已经成功部署了。</p> <div class="tip custom-block"><p class="custom-block-title">为什么需要 hookguard？</p> <p>Hookguard 可以防止来自恶意用户的非法更新请求（比如减少统计数目以及甚至篡改记录的url）。</p></div> <div class="tip custom-block"><p class="custom-block-title">请注意免费版 LeanEngine 的限制</p> <p>Hookguard 依赖于 LeanEngine。但是，免费版 LeanEngine 有使用时间限制和休眠政策，详情可以查看 <a href="https://leancloud.cn/docs/leanengine_plan.html#hash643734278" target="_blank" rel="noopener noreferrer">LeanEngine Plan<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。所以，部署了 hookguard 的 Counter 在更新操作时可能会在某些时刻响应较慢。</p></div> <h2 id="集成到你的主题"><a href="#集成到你的主题" aria-hidden="true" class="header-anchor">#</a> 集成到你的主题</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>如果你的主题已经集成了这个插件，请根据你主题的文档开启。</p></div> <p>把 <code>&lt;%- leancloud_counter_script() %&gt;</code> 加入你的全局模板中以渲染 LeanCloud Counter 脚本。</p> <p>把 <code>&lt;%- leancloud_counter({ action: 'inc' }) %&gt;</code> 加入你希望计数的页面模板中。</p> <p>博主也可以在某些源文件中使用 <code>leanCounter</code> 标签以手动渲染某些计数器。</p> <p>参见 <a href="./tagsandhelpers">标签（Tags）与辅助函数（Helpers）</a> 以获得更多细节。</p> <h2 id="更多"><a href="#更多" aria-hidden="true" class="header-anchor">#</a> 更多</h2> <p>参见 <a href="./troubleshooting">常见问题</a> 以解决常见的问题。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/hexo-leancloud-counter/zh/tagsandhelpers.html">
          标签（Tags）与辅助函数（Helpers）
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hexo-leancloud-counter/assets/js/app.7e995820.js" defer></script><script src="/hexo-leancloud-counter/assets/js/2.2dd1278b.js" defer></script><script src="/hexo-leancloud-counter/assets/js/9.15056421.js" defer></script>
  </body>
</html>
